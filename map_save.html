<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>위·경도 확인 및 저장</title>
    <style>
        /* ➊ 기본 레이아웃 */
        html, body {height: 100%; margin: 0; padding: 0; cursor: crosshair;}
        #map          {width: 100%; height: 100%; min-height: 300px; cursor: crosshair;}

        /* ➋ 하단 버튼 영역 */
        .button-container {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: #fff; padding: 10px; box-sizing: border-box;
            z-index: 9999; display: flex; flex-wrap: wrap; gap: 8px; align-items: center;
            font-family: "Pretendard", sans-serif;
        }

        /* ➌ 저장 목록 */
        #savedCoords {
            flex: 1 1 100%; /* 한 줄 전체 사용 */
            margin-top: 6px; padding: 4px; height: 80px;
            font-size: 12px; white-space: pre-wrap; overflow: auto;
            border: 1px solid #ccc; border-radius: 4px; background: #f9f9f9;
        }
    </style>
</head>
<body>

<!-- 지도 -->
<div id="map"></div>

<!-- 하단 기능 패널 -->
<div class="button-container">
    <button id="locBtn">위치점검</button>
    <button onclick="setOverlayMapTypeId('roadmap')">일반지도</button>
    <button onclick="setOverlayMapTypeId('use_district')">지적편집도</button>
    <span id="copyNotice" style="display:none;color:#008000;font-size:12px;">좌표가 클립보드에 복사되었습니다.</span>
    <pre id="savedCoords" readonly></pre>
</div>

<!-- Kakao Maps SDK : 반드시 본인 APP KEY 로 교체 -->
<script defer src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=ca1951eaafbfe12089ef2f2d40755c2b&autoload=false"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  // kakao SDK 스크립트가 로드된 후 실행
  kakao.maps.load(function () {

    /* ======================= 지도 초기화 ======================= */
    const mapContainer = document.getElementById('map');
    const mapOption    = {center: new kakao.maps.LatLng(35.84286091497955, 128.76508285268582), level: 3};

    const map = new kakao.maps.Map(mapContainer, mapOption);
    map.addControl(new kakao.maps.MapTypeControl(), kakao.maps.ControlPosition.TOPRIGHT);
    map.addControl(new kakao.maps.ZoomControl(),    kakao.maps.ControlPosition.RIGHT);

    /* ======================= 마커 & 인포윈도우 ======================= */
    let clickMarker   = null; // 지도 클릭 시 찍히는 마커
    let myPosMarker   = null; // 위치점검 시 찍히는 마커
    const infowindow  = new kakao.maps.InfoWindow({zIndex: 1});

    // 지도 클릭 – 위·경도 마커 표시
    kakao.maps.event.addListener(map, 'click', function(evt){
        const latlng = evt.latLng;
        const msg    = `위도: ${latlng.getLat()}, 경도: ${latlng.getLng()}`;
        setMarker(latlng, msg, 'click');
    });

    /**
     * 마커 표시 유틸
     * @param {LatLng} latlng  - 좌표
     * @param {String} message - 인포윈도우 내용 (HTML)
     * @param {"click"|"mypos"} type - 마커 종류 구분
     */
    function setMarker(latlng, message, type){
        // 타입별 기존 마커 제거
        if(type === 'click' && clickMarker){ clickMarker.setMap(null); }
        if(type === 'mypos' && myPosMarker){ myPosMarker.setMap(null); }

        const marker = new kakao.maps.Marker({map, position: latlng});
        infowindow.setContent(`<div style="padding:4px;">${message}</div>`);
        infowindow.open(map, marker);

        if(type === 'click') clickMarker = marker;
        if(type === 'mypos')  myPosMarker = marker;
    }

    /* ======================= 위치점검 기능 ======================= */
    const savedCoordsEl = document.getElementById('savedCoords');
    const copyNoticeEl  = document.getElementById('copyNotice');
    const savedCoords   = JSON.parse(localStorage.getItem('coords') || '[]');
    renderSaved();

    document.getElementById('locBtn').addEventListener('click', getCurrentPosition);

    function getCurrentPosition(){
        if(!navigator.geolocation){
            alert('이 브라우저는 위치 기능을 지원하지 않습니다.');
            return;
        }
        navigator.geolocation.getCurrentPosition(success, fail, {enableHighAccuracy: true, timeout: 5000});
    }

    function success(pos){
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        const latlng = new kakao.maps.LatLng(lat, lon);

        // 지도 이동 및 마커 표시
        map.panTo(latlng);
        setMarker(latlng, '★ 내 위치 ★', 'mypos');

        // 좌표 저장 및 렌더링
        saveCoords(lat, lon);
    }

    function fail(err){
        alert('위치 정보를 가져올 수 없습니다.');
        console.error(err);
    }

    /* -------------------- 저장 / 표시 / 복사 -------------------- */
    function saveCoords(lat, lon){
        savedCoords.push({lat, lon, ts: Date.now()});
        localStorage.setItem('coords', JSON.stringify(savedCoords));
        renderSaved();
        // 클립보드 복사 (HTTPS 환경에서 작동)
        if(navigator.clipboard){
            navigator.clipboard.writeText(`${lat}, ${lon}`).then(showCopyNotice);
        }
    }

    function renderSaved(){
        savedCoordsEl.textContent = savedCoords.map(c => `${c.lat}, ${c.lon}`).join('\n');
    }

    function showCopyNotice(){
        copyNoticeEl.style.display = 'inline';
        setTimeout(()=>copyNoticeEl.style.display='none', 2000);
    }

    /* ======================= 지도 타입 전환 ======================= */
    let currentOverlay = null;
    window.setOverlayMapTypeId = function(type){
        // 1) 기존 오버레이 제거
        if(currentOverlay){ map.removeOverlayMapTypeId(currentOverlay); currentOverlay = null; }

        // 2) 기본 지도
        if(type === 'roadmap'){
            map.setMapTypeId(kakao.maps.MapTypeId.ROADMAP);
            return;
        }

        // 3) 지적편집도 – ROADMAP 위에 오버레이로 겹침
        if(type === 'use_district'){
            map.setMapTypeId(kakao.maps.MapTypeId.ROADMAP);
            currentOverlay = kakao.maps.MapTypeId.USE_DISTRICT;
            map.addOverlayMapTypeId(currentOverlay);
        }
    };

  }); // kakao.maps.load end
}); // DOMContentLoaded end
</script>
</body>
</html>
