<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>지상경계점등록부</title>
    <link rel="stylesheet" href="CSS/DG_YC_Land_CSS.css">
    <script>
        function loadImages() {
            const urlParams = new URLSearchParams(window.location.search);
            let code = decodeURIComponent(urlParams.get('code') || '');
        
            if (!code) {
                document.getElementById("Table2").innerHTML = "<h3>잘못된 접근입니다.</h3>";
                return;
            }
        
            // URL 디코딩 적용
            code = decodeURIComponent(code);
        
            const imageContainer = document.getElementById("Table2").querySelector(".td2");
            imageContainer.innerHTML = `
                <div class="div-left"><span class="bold blue">⊙ 지상경계점등록부</span></div>
                <hr class="hr-left"><br>
            `;
        
            let foundImages = false; // 이미지가 하나라도 있으면 true
            let totalImages = 10;   // 최대 이미지 개수
            let imageLoadCount = 0;  // 정상적으로 로드된 이미지 개수

            for (let i = 1; i <= totalImages; i++) {
                let img = document.createElement("img");
                let encodedCode = encodeURIComponent(code); // URL 인코딩
                // let imgUrl = `http://www.dggis.kr/Youngcheon/QR/BuganYusang06310001/IMG_Land/${encodedCode}_${i.toString().padStart(2, '0')}.jpg`;
                let imgUrl = `https://smbahk.github.io/dggis/YC_Land/IMG_Land/${encodedCode}_${i.toString().padStart(2, '0')}.jpg`;
                
                img.src = imgUrl;
                img.className = "img-responsive";
                img.alt = `지상경계점등록부 이미지 ${i}`;
                
                let imgLink = document.createElement("a");
                imgLink.href = imgUrl;
                imgLink.target = "_blank";
                imgLink.rel = "noopener";
                imgLink.appendChild(img);
        
                let divContainer = document.createElement("div");
                divContainer.className = "div-center";

                // divContainer.appendChild(imgLink);
                img.onload = function () {
                    img.style.display = "block"; // 이미지가 정상적으로 로딩되면 표시
                    divContainer.appendChild(imgLink);
                    imageContainer.appendChild(divContainer);
                    imageContainer.appendChild(document.createElement("br"));
                    imageContainer.appendChild(document.createElement("hr"));
                    foundImages = true;
                    imageLoadCount++;
                };
        
                // img.onerror = function () { divContainer.style.display = "none"; }; // 이미지가 없으면 숨김 처리
                // imageContainer.appendChild(divContainer);
                // imageContainer.appendChild(document.createElement("br"));
                // imageContainer.appendChild(document.createElement("hr"));
                img.onerror = function () {
                    // 이미지가 없으면 div 추가 X
                    imgLink.remove();
                    divContainer.remove();
                };
        
                foundImages = true;
            }
        
            if (!foundImages) {
                imageContainer.innerHTML += "<p style='text-align:center; color:red;'>이미지를 찾을 수 없습니다.</p>";
            }
        }
        
        window.onload = loadImages;        
    </script>
    <!-- 
    동시접속자가 많을것을 가정하여 모든 이미지를 한 번에 로딩하지 않고, 비동기 방식으로 로드
    Lazy Load 적용 중... 어렵다. --;; 
    -->
    <!-- script>
        function loadImagesAsync() {
            const urlParams = new URLSearchParams(window.location.search);
            let code = decodeURIComponent(urlParams.get('code') || '');
        
            if (!code) {
                document.getElementById("Table2").innerHTML = "<h3>잘못된 접근입니다.</h3>";
                return;
            }
        
            const imageContainer = document.getElementById("Table2").querySelector(".td2");
            imageContainer.innerHTML = '<div class="div-left"><span class="bold blue">⊙ 지상경계점등록부</span></div><hr class="hr-left"><br>';
        
            let foundImages = false; // 이미지가 하나라도 있으면 true
            let imagesLoaded = 0;  // 로드된 이미지 개수
            let totalImages = 10;   // 최대 이미지 개수
        
            for (let i = 1; i <= totalImages; i++) {
                let encodedCode = encodeURIComponent(code);
                // let imgUrl = `http://www.dggis.kr/Youngcheon/QR/BuganYusang06310001/IMG_Land/${encodedCode}_${i.toString().padStart(2, '0')}.jpg`;
                let imgUrl = `https://smbahk.github.io/dggis/YC_Land/IMG_Land/${encodedCode}_${i.toString().padStart(2, '0')}.jpg`;
        
                let img = document.createElement("img");
                img.className = "img-responsive";
                img.alt = `지상경계점등록부 이미지 ${i}`;
                img.loading = "lazy"; // Lazy Load 적용 -- 사용자가 스크롤할 때만 이미지가 로딩되므로 초기 부하가 줄어듦
                img.style.display = "none"; // 초기에는 숨김
        
                let imgLink = document.createElement("a");
                imgLink.href = imgUrl;
                imgLink.target = "_blank";
                imgLink.rel = "noopener";
                imgLink.appendChild(img);
        
                let divContainer = document.createElement("div");
                divContainer.className = "div-center";
        
                img.onload = function () {
                    img.style.display = "block"; // 이미지가 정상적으로 로딩되면 표시
                    divContainer.appendChild(imgLink);
                    imageContainer.appendChild(divContainer);
                    imageContainer.appendChild(document.createElement("br"));
                    imageContainer.appendChild(document.createElement("hr"));
                    foundImages = true; // 이미지가 로드 되었을 때 즉시 반영
                };
                
                // onerror 이벤트는 이미지가 로드 실패 시 실행됨 -> 존재하지 않는 이미지는 자동으로 제외됨
                img.onerror = function () {
                    // 이미지가 로드 실패하면 div 자체를 추가하지 않음
                    divContainer.remove();
                };
        
                img.src = imgUrl; // 비동기 로드 시작
        
                imagesLoaded++;
            }
        
            // foundImages 값이 비동기적으로 업데이트되므로, setTimeout(1초) 후에도 false로 남아 메시지가 출력될 수 있음
            // 모든 이미지 요청이 끝난 후 2초 후 검사로 변경 함.
            setTimeout(() => {
                if (!foundImages) {
                    imageContainer.innerHTML += "<p style='text-align:center; color:red;'>이미지를 찾을 수 없습니다.</p>";
                }
            }, 2000); // 2초 후 검사하여 아무 이미지도 없으면 메시지 출력
        }
        
        window.onload = loadImagesAsync;                       
    </script -->
</head>
<body>
    <table id="Table1" class="table1">
        <tbody>
            <tr class="tr1">
                <td class="td1">
                    <br><br>
                    <div class="div-center"><span class="title">부동산종합정보서비스</span></div>
                    <br><br>
                    <table id="Table2" class="table2">
                        <tbody>
                            <tr class="tr2">
                                <td class="td2">
                                    <!-- JavaScript 이미지 삽입. -->
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table id="Table3" class="table3">
                        <tbody>
                            <tr class="tr3">
                                <td class="td3">
                                    <br>
                                    <div class="div-left"><span class="bold blue">⊙ 토지정보</span></div><br>
                                    <table id="Table4" class="table4">
                                        <tbody>
                                            <tr class="tr4">
                                                <td class="td4">
                                                    <div class="div-left"><span class="bold">경북 부동산정보조회 시스템</span></div>
                                                </td>
                                            </tr>
                                            <tr class="tr4">
                                                <td class="td4">
                                                    <div class="div-left">
                                                        <img alt="링크 아이콘" width="14" height="14" src="https://smbahk.github.io/dggis/YC_Land/IMAGE/link_logo.png"> 
                                                        <a href="http://kras.gb.go.kr/land_info/info/baseInfo/baseInfo.do">부동산정보 통합 열람</a>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table><br>
                                    <table id="Table5" class="table5">
                                        <tbody>
                                            <tr class="tr5">
                                                <td class="td5">
                                                    <div class="div-left"><span class="bold">토지이음 - 이음지도, 용어사전, 질의회신사례, 규제법령집, 주민의견청취 공람, 도시계획통계 제공</span></div>
                                                </td>
                                            </tr>
                                            <tr class="tr5">
                                                <td class="td5">
                                                    <div class="div-left">
                                                        <img alt="토지이음 누리집 아이콘" width="14" height="14" src="http://www.eum.go.kr/web/favicon.ico"> 
                                                        <a href="https://www.eum.go.kr/web/am/amMain.jsp">토지이음 누리집</a>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table><br>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="div-left"><br></div>
                </td>
            </tr>
        </tbody>
    </table>
</body>
</html>